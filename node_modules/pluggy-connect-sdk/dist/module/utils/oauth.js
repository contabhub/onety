import { openInCordovaInAppBrowser } from './cordova';
export function openOauthUrlInCordovaBrowser(url, onComplete) {
    const inAppBrowserWindow = openInCordovaInAppBrowser(url, '_blank');
    // track oauth result in navigation URL
    inAppBrowserWindow === null || inAppBrowserWindow === void 0 ? void 0 : inAppBrowserWindow.addEventListener('loadstop', (event) => {
        const { url } = event;
        const isPluggyOauthCallbackUrl = (url.startsWith('https://api.pluggy.ai/') ||
            url.startsWith('https://api.pluggy.dev/') ||
            url.startsWith('http://localhost:9090/')) &&
            url.includes('/oauthCallback.html');
        if (!isPluggyOauthCallbackUrl) {
            // not oauth result URL, ignore
            return;
        }
        const params = new URLSearchParams(url.split('?')[1]);
        const oauthResult = Object.fromEntries(params.entries());
        onComplete(oauthResult);
        inAppBrowserWindow.close();
    });
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoib2F1dGguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvdXRpbHMvb2F1dGgudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLHlCQUF5QixFQUFFLE1BQU0sV0FBVyxDQUFDO0FBRXRELE1BQU0sVUFBVSw0QkFBNEIsQ0FDMUMsR0FBVyxFQUNYLFVBQXVFO0lBRXZFLE1BQU0sa0JBQWtCLEdBQUcseUJBQXlCLENBQUMsR0FBRyxFQUFFLFFBQVEsQ0FBQyxDQUFDO0lBRXBFLHVDQUF1QztJQUN2QyxrQkFBa0IsYUFBbEIsa0JBQWtCLHVCQUFsQixrQkFBa0IsQ0FBRSxnQkFBZ0IsQ0FDbEMsVUFBVSxFQUNWLENBQUMsS0FBd0IsRUFBRSxFQUFFO1FBQzNCLE1BQU0sRUFBRSxHQUFHLEVBQUUsR0FBRyxLQUFLLENBQUM7UUFFdEIsTUFBTSx3QkFBd0IsR0FDNUIsQ0FBQyxHQUFHLENBQUMsVUFBVSxDQUFDLHdCQUF3QixDQUFDO1lBQ3ZDLEdBQUcsQ0FBQyxVQUFVLENBQUMseUJBQXlCLENBQUM7WUFDekMsR0FBRyxDQUFDLFVBQVUsQ0FBQyx3QkFBd0IsQ0FBQyxDQUFDO1lBQzNDLEdBQUcsQ0FBQyxRQUFRLENBQUMscUJBQXFCLENBQUMsQ0FBQztRQUV0QyxJQUFJLENBQUMsd0JBQXdCLEVBQUU7WUFDN0IsK0JBQStCO1lBQy9CLE9BQU87U0FDUjtRQUVELE1BQU0sTUFBTSxHQUFHLElBQUksZUFBZSxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUV0RCxNQUFNLFdBQVcsR0FBRyxNQUFNLENBQUMsV0FBVyxDQUFDLE1BQU0sQ0FBQyxPQUFPLEVBQUUsQ0FFaEMsQ0FBQztRQUV4QixVQUFVLENBQUMsV0FBVyxDQUFDLENBQUM7UUFDeEIsa0JBQWtCLENBQUMsS0FBSyxFQUFFLENBQUM7SUFDN0IsQ0FBQyxFQUNEO0FBQ0osQ0FBQyJ9