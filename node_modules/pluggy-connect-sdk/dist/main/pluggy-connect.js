"use strict";
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.PluggyConnect = exports.initialize = void 0;
const zoid_frameworks_frame_1 = require("zoid/dist/zoid.frameworks.frame");
const css_1 = require("./components/loader/css");
const html_1 = require("./components/loader/html");
const css_2 = require("./components/modal/css");
const html_2 = require("./components/modal/html");
const cordova_1 = require("./utils/cordova");
const oauth_1 = require("./utils/oauth");
const once_1 = require("./utils/once");
const props_1 = require("./utils/props");
const version_1 = require("./version");
// the URL where the widget component is being hosted
const CONNECT_PRODUCTION_URL = 'https://connect.pluggy.ai';
let zoidComponentInstance;
// reference to the container uid, generated once it's rendered
let pluggyConnectContainerUid;
/**
 * Helper to wrap container class names with current container UID
 * @param className
 */
function containerCssClassName(className) {
    return `${pluggyConnectContainerUid}_${className}`;
}
/**
 * Method to be executed from both the child and parent components, to execute the
 * handshake between both so the parent can render the child.
 *
 * @returns a singleton ZoidComponent reference, that will take care of
 * wrapping and rendering the actual ZoidComponentInstance (this
 * should be instantiated only once per page/context).
 */
function initialize() {
    if (!zoidComponentInstance) {
        zoidComponentInstance = zoid_frameworks_frame_1.create({
            // The html tag used to render the component
            tag: 'pluggy-connect-widget',
            // The url of the page that will show in the iframe or popup, when someone includes the component on their site
            url: ({ props }) => {
                const { url: urlByProp = CONNECT_PRODUCTION_URL } = props;
                return urlByProp;
            },
            dimensions: {
                width: '320px',
                height: '568px',
            },
            props: {
                connectToken: {
                    type: 'string',
                },
                url: {
                    type: 'string',
                    required: false,
                },
                includeSandbox: {
                    type: 'boolean',
                    required: false,
                },
                allowConnectInBackground: {
                    type: 'boolean',
                    required: false,
                },
                allowFullscreen: {
                    type: 'boolean',
                    required: false,
                },
                updateItem: {
                    type: 'string',
                    required: false,
                },
                connectorTypes: {
                    type: 'array',
                    required: false,
                },
                connectorIds: {
                    type: 'array',
                    required: false,
                },
                countries: {
                    type: 'array',
                    required: false,
                },
                selectedConnectorId: {
                    type: 'number',
                    required: false,
                },
                language: {
                    type: 'string',
                    required: false,
                },
                theme: {
                    type: 'string',
                    required: false,
                },
                moveSecurityData: {
                    type: 'string',
                    required: false,
                },
                products: {
                    type: 'array',
                    required: false,
                },
                // object with CPF and CNPJ
                openFinanceParameters: {
                    type: 'object',
                    required: false,
                },
                sdkVersion: {
                    type: 'array',
                    required: false,
                    default: () => version_1.getSdkVersion(),
                },
                _runningInCordova: {
                    type: 'boolean',
                    required: false,
                    default: () => cordova_1.isRunningInCordova(),
                },
                onSuccessProp: {
                    type: 'function',
                    required: false,
                },
                onErrorProp: {
                    type: 'function',
                    required: false,
                },
                onOpenProp: {
                    type: 'function',
                    required: false,
                },
                onHideProp: {
                    type: 'function',
                    required: false,
                },
                onCloseProp: {
                    type: 'function',
                    required: false,
                },
                onEventProp: {
                    type: 'function',
                    required: false,
                },
            },
            attributes: {
                iframe: {
                    scrolling: 'no',
                    title: 'Pluggy',
                },
                popup: {
                    scrolling: 'no',
                    title: 'Pluggy',
                },
            },
            prerenderTemplate({ doc, props }) {
                const htmlNew = doc.createElement('html');
                htmlNew.innerHTML = html_1.loaderComponentHtml({
                    nonce: props.cspNonce,
                });
                return htmlNew;
            },
            containerTemplate({ doc, dimensions: { height, width }, close, uid, frame, prerenderFrame, event, props, }) {
                if (!prerenderFrame || !frame) {
                    throw new Error('Unexpected state: prerenderFrame or frame not defined');
                }
                // set container uid global reference
                pluggyConnectContainerUid = uid;
                const container = doc.createElement('div');
                const connectTheme = props.theme || 'light';
                container.id = uid;
                container.innerHTML = html_2.getModalWrapper(uid, connectTheme);
                const frameContainer = container.querySelector(`.${uid}_container`);
                if (!frameContainer) {
                    throw new Error('Unexpected state: not found frame container');
                }
                const visibleClassName = containerCssClassName('visible');
                const invisibleClassName = containerCssClassName('invisible');
                const prerenderFrameClassName = containerCssClassName('prerender-frame');
                frameContainer.appendChild(frame);
                frameContainer.appendChild(prerenderFrame);
                // Add styles
                const style = doc.createElement('style');
                // if allowFullscreen is not defined, default to true
                const allowFullscreenOrDefault = props.allowFullscreen !== undefined ? props.allowFullscreen : true;
                style.innerHTML = [
                    css_2.getCSS({
                        uid,
                        themeColor: 'fafafa',
                        height,
                        width,
                        allowFullscreen: allowFullscreenOrDefault,
                    }),
                    css_1.getContainerCss({ uid }),
                ].join('\n');
                container.appendChild(style);
                prerenderFrame.classList.add(prerenderFrameClassName);
                prerenderFrame.classList.add(visibleClassName);
                frame.classList.add(invisibleClassName);
                event.on(zoid_frameworks_frame_1.EVENT.RENDERED, () => {
                    // hide prerender frame, display content frame
                    prerenderFrame.classList.remove(visibleClassName);
                    prerenderFrame.classList.add(invisibleClassName);
                    frame.classList.remove(invisibleClassName);
                    frame.classList.add(visibleClassName);
                });
                // Remove scrolling from document body when modal is open (ie. visible)
                const modalVisibleClassName = containerCssClassName('has-modal-visible');
                event.on(zoid_frameworks_frame_1.EVENT.DISPLAY, () => {
                    // modal displayed, add visible class & call onOpen callback
                    document.body.classList.add(modalVisibleClassName);
                    const { onOpenProp } = props;
                    onOpenProp === null || onOpenProp === void 0 ? void 0 : onOpenProp();
                });
                // Wrap onCloseProp to be called only once, per component instance, which is
                // what we want to allow.
                // This "hack" is necessary because Zoid may trigger 2 times EVENT.CLOSE event,
                // for example when removing the container element from DOM and when explicitly
                // calling close() handler at the same time.
                // Each time a new container/component is rendered, the props are re-created from scratch,
                // so this will work for all cases.
                const onClosePropWrapper = props.onCloseProp
                    ? once_1.once(props.onCloseProp)
                    : null;
                event.on(zoid_frameworks_frame_1.EVENT.CLOSE, () => {
                    // modal closed, remove visible class & call onClose callback
                    // Note: this callback may be called 2 times in some cases due to Zoid logic,
                    // for example when unmounting container component AND calling close() explicitly.
                    document.body.classList.remove(modalVisibleClassName);
                    onClosePropWrapper === null || onClosePropWrapper === void 0 ? void 0 : onClosePropWrapper();
                });
                // receive message from iframe
                window.addEventListener('message', (event) => {
                    const { origin, data } = event;
                    const { url: connectWebappUrl = 'https://connect.pluggy.ai', } = props;
                    if (origin !== connectWebappUrl) {
                        // origin not matching, comming from another place -> ignore message
                        return;
                    }
                    let pluggyConnectMessage;
                    try {
                        pluggyConnectMessage = JSON.parse(data);
                    }
                    catch (_a) {
                        // could not parse, data is not a valid JSON string
                        return;
                    }
                    if (pluggyConnectMessage.type === 'OAUTH_OPEN' &&
                        cordova_1.isRunningInCordova()) {
                        const { message: oauthUrl } = pluggyConnectMessage;
                        // in the case of pluggy-connect running in Cordova mobile native environment
                        // we must handle the Oauth popup opening manually by explicitly managing a new iframe window
                        oauth_1.openOauthUrlInCordovaBrowser(oauthUrl, (payload) => { var _a; return (_a = frame.contentWindow) === null || _a === void 0 ? void 0 : _a.postMessage(payload, '*'); });
                        return;
                    }
                    if (pluggyConnectMessage.type === 'LINK_OPEN' &&
                        cordova_1.isRunningInCordova()) {
                        const { message: externalUrl } = pluggyConnectMessage;
                        // in the case of pluggy-connect running in Cordova mobile native environment,
                        // open the link specifically in the system browser,
                        // so the main app frame is not blocked, and the user can go back to the app easily
                        cordova_1.openInCordovaInAppBrowser(externalUrl, '_system');
                        return;
                    }
                    if (pluggyConnectMessage.type === 'CONTINUE_IN_BACKGROUND') {
                        // hide pluggy-connect, we remove the 'has-modal-visible' class to restore the scroll
                        document.body.classList.remove(modalVisibleClassName);
                        return;
                    }
                }, false);
                // Register modal close() on 'Escape' key button press
                document.addEventListener('keydown', function escapeKeyCloseHandler(event) {
                    if (event.key !== 'Escape') {
                        return;
                    }
                    // escape key -> close (and remove 'keydown' listener)
                    close();
                    document.removeEventListener('keydown', escapeKeyCloseHandler);
                });
                return container;
            },
        });
    }
    return zoidComponentInstance;
}
exports.initialize = initialize;
class PluggyConnect {
    constructor(props) {
        this.zoidComponent = initialize();
        // extend component props with current wrapper props
        const extendedProps = Object.assign(Object.assign({}, props), { sdkVersion: version_1.getSdkVersion() });
        // adapt props to avoid collision with Zoid component props
        // assign to private variable for reusability by React wrapper
        this.componentPropsExtendedAdapted = props_1.adaptPluggyConnectProps(extendedProps);
    }
    /**
     * Render the component using the specified component props,
     * as a modal with an iframe, appended to the page body (or the DOM uppermost element).
     *
     * @param containerElement - parent element where component should be rendered at. If not specified, will render at body root element.
     * @returns promise that resolves when rendered successfully, or throws if failed.
     */
    init(containerElement) {
        const container = containerElement ||
            (document.getElementsByTagName('body') ||
                document.getElementsByTagName('html') ||
                document.getElementsByTagName('div'))[0];
        // initialize zoid componentInstance
        this.componentInstance = this.zoidComponent(this.componentPropsExtendedAdapted);
        return this.componentInstance.render(container).catch((error) => {
            console.error(`Failed to render <PluggyConnect /> component`, error);
            throw error;
        });
    }
    /**
     * Manually cleanup the component.
     * This is not recommended, you should create the component once
     * and re-render it as needed each new time to save resources.
     */
    destroy() {
        zoidComponentInstance = undefined;
        return zoid_frameworks_frame_1.destroy();
    }
    /**
     * If the component is minimized, re-open it.
     * @retruns promise that resolves when re-opened successfully, or throws if failed.
     */
    show() {
        return __awaiter(this, void 0, void 0, function* () {
            if (!this.componentInstance) {
                throw new Error('Failed to show <PluggyConnect /> component: component not initialized');
            }
            try {
                // open wrapper modal
                yield this.componentInstance.show();
                // add modal visible class
                const modalVisibleClassName = containerCssClassName('has-modal-visible');
                document.body.classList.add(modalVisibleClassName);
            }
            catch (error) {
                console.error(`Failed to show <PluggyConnect /> component`, error);
                throw error;
            }
        });
    }
    /**
     * Minimize the component.
     * Useful if you want to hide Connect widget after credentials have been submitted,
     * and you want to just continue connecting in background while still listening to
     * other callback events.
     */
    hide() {
        return __awaiter(this, void 0, void 0, function* () {
            if (!this.componentInstance) {
                throw new Error('Failed to hide <PluggyConnect /> component: component not initialized');
            }
            try {
                // hide wrapper modal
                yield this.componentInstance.hide();
                // remove modal visible class
                const modalVisibleClassName = containerCssClassName('has-modal-visible');
                document.body.classList.remove(modalVisibleClassName);
            }
            catch (error) {
                console.error(`Failed to hide <PluggyConnect /> component`, error);
                throw error;
            }
        });
    }
}
exports.PluggyConnect = PluggyConnect;
exports.default = PluggyConnect;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGx1Z2d5LWNvbm5lY3QuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvcGx1Z2d5LWNvbm5lY3QudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7O0FBT0EsMkVBTXlDO0FBRXpDLGlEQUEwRDtBQUMxRCxtREFBK0Q7QUFDL0QsZ0RBQWdEO0FBQ2hELGtEQUEwRDtBQUMxRCw2Q0FBZ0Y7QUFDaEYseUNBQTZEO0FBQzdELHVDQUFvQztBQUNwQyx5Q0FHdUI7QUFDdkIsdUNBQTBDO0FBMkYxQyxxREFBcUQ7QUFDckQsTUFBTSxzQkFBc0IsR0FBRywyQkFBMkIsQ0FBQztBQU0zRCxJQUFJLHFCQUE2RCxDQUFDO0FBRWxFLCtEQUErRDtBQUMvRCxJQUFJLHlCQUE2QyxDQUFDO0FBRWxEOzs7R0FHRztBQUNILFNBQVMscUJBQXFCLENBQUMsU0FBaUI7SUFDOUMsT0FBTyxHQUFHLHlCQUF5QixJQUFJLFNBQVMsRUFBRSxDQUFDO0FBQ3JELENBQUM7QUFFRDs7Ozs7OztHQU9HO0FBQ0gsU0FBZ0IsVUFBVTtJQUN4QixJQUFJLENBQUMscUJBQXFCLEVBQUU7UUFDMUIscUJBQXFCLEdBQUcsOEJBQU0sQ0FBNEI7WUFDeEQsNENBQTRDO1lBQzVDLEdBQUcsRUFBRSx1QkFBdUI7WUFFNUIsK0dBQStHO1lBQy9HLEdBQUcsRUFBRSxDQUFDLEVBQUUsS0FBSyxFQUFpQyxFQUFFLEVBQUU7Z0JBQ2hELE1BQU0sRUFBRSxHQUFHLEVBQUUsU0FBUyxHQUFHLHNCQUFzQixFQUFFLEdBQUcsS0FBSyxDQUFDO2dCQUMxRCxPQUFPLFNBQVMsQ0FBQztZQUNuQixDQUFDO1lBRUQsVUFBVSxFQUFFO2dCQUNWLEtBQUssRUFBRSxPQUFPO2dCQUNkLE1BQU0sRUFBRSxPQUFPO2FBQ2hCO1lBRUQsS0FBSyxFQUFFO2dCQUNMLFlBQVksRUFBRTtvQkFDWixJQUFJLEVBQUUsUUFBUTtpQkFDZjtnQkFDRCxHQUFHLEVBQUU7b0JBQ0gsSUFBSSxFQUFF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