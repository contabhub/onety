"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.openOauthUrlInCordovaBrowser = void 0;
const cordova_1 = require("./cordova");
function openOauthUrlInCordovaBrowser(url, onComplete) {
    const inAppBrowserWindow = cordova_1.openInCordovaInAppBrowser(url, '_blank');
    // track oauth result in navigation URL
    inAppBrowserWindow === null || inAppBrowserWindow === void 0 ? void 0 : inAppBrowserWindow.addEventListener('loadstop', (event) => {
        const { url } = event;
        const isPluggyOauthCallbackUrl = (url.startsWith('https://api.pluggy.ai/') ||
            url.startsWith('https://api.pluggy.dev/') ||
            url.startsWith('http://localhost:9090/')) &&
            url.includes('/oauthCallback.html');
        if (!isPluggyOauthCallbackUrl) {
            // not oauth result URL, ignore
            return;
        }
        const params = new URLSearchParams(url.split('?')[1]);
        const oauthResult = Object.fromEntries(params.entries());
        onComplete(oauthResult);
        inAppBrowserWindow.close();
    });
}
exports.openOauthUrlInCordovaBrowser = openOauthUrlInCordovaBrowser;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoib2F1dGguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvdXRpbHMvb2F1dGgudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7O0FBQUEsdUNBQXNEO0FBRXRELFNBQWdCLDRCQUE0QixDQUMxQyxHQUFXLEVBQ1gsVUFBdUU7SUFFdkUsTUFBTSxrQkFBa0IsR0FBRyxtQ0FBeUIsQ0FBQyxHQUFHLEVBQUUsUUFBUSxDQUFDLENBQUM7SUFFcEUsdUNBQXVDO0lBQ3ZDLGtCQUFrQixhQUFsQixrQkFBa0IsdUJBQWxCLGtCQUFrQixDQUFFLGdCQUFnQixDQUNsQyxVQUFVLEVBQ1YsQ0FBQyxLQUF3QixFQUFFLEVBQUU7UUFDM0IsTUFBTSxFQUFFLEdBQUcsRUFBRSxHQUFHLEtBQUssQ0FBQztRQUV0QixNQUFNLHdCQUF3QixHQUM1QixDQUFDLEdBQUcsQ0FBQyxVQUFVLENBQUMsd0JBQXdCLENBQUM7WUFDdkMsR0FBRyxDQUFDLFVBQVUsQ0FBQyx5QkFBeUIsQ0FBQztZQUN6QyxHQUFHLENBQUMsVUFBVSxDQUFDLHdCQUF3QixDQUFDLENBQUM7WUFDM0MsR0FBRyxDQUFDLFFBQVEsQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDO1FBRXRDLElBQUksQ0FBQyx3QkFBd0IsRUFBRTtZQUM3QiwrQkFBK0I7WUFDL0IsT0FBTztTQUNSO1FBRUQsTUFBTSxNQUFNLEdBQUcsSUFBSSxlQUFlLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBRXRELE1BQU0sV0FBVyxHQUFHLE1BQU0sQ0FBQyxXQUFXLENBQUMsTUFBTSxDQUFDLE9BQU8sRUFBRSxDQUVoQyxDQUFDO1FBRXhCLFVBQVUsQ0FBQyxXQUFXLENBQUMsQ0FBQztRQUN4QixrQkFBa0IsQ0FBQyxLQUFLLEVBQUUsQ0FBQztJQUM3QixDQUFDLEVBQ0Q7QUFDSixDQUFDO0FBakNELG9FQWlDQyJ9